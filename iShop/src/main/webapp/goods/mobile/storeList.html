<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>门店列表</title>
    <link rel="stylesheet" href="css/reset.css"/>
    <!--匹配css-->
    <link rel="stylesheet" href="css/storeList.css"/>
    <meta content="telephone=no,email=no" name="format-detection">
</head>
<body>
<div class="title">仅显示距离你最近的30家商店 <div class="more_store">查看更多门店<span>></span></div></div>
<div class="main">
    <!--盒子模板-->
    <!--<div class="box">-->
        <!--<div class="left"><img src="${img}" alt=""/></div>-->
        <!--<div class="right">-->
            <!--<div class="right_name">${shop}<img src="image/store_00.png" alt=""/><span>$num}公里&nbsp;&nbsp;|&nbsp;&nbsp;</span></div>-->
            <!--<div class="right_add">地址：${add}</div>-->
        <!--</div>-->
    <!--</div>-->
</div>
<script src="js/flexible.js?20161209"></script>
<script src="js/jquery-1.11.1.js"></script>
<script src="js/insidePostRequire.js"></script>
<script src="http://cdn.bootcss.com/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<!--匹配js-->
<script>
    var oc = new ObjectControl();
    function getPage(){
        var app_user_name = 'gh_a707333490f3';
        var open_id = 'ogUZEuA3jm6M3TxrZQOGAjLGpWpA';
        oc.postRequire("get", "http://wechat.dev.bizvane.com/app/wechat/getNearByStore?app_user_name="+app_user_name+"&open_id="+open_id, "0", "", function (data) {
            if (data.code == "0") {
                var msg = JSON.parse(data.message);
                var list =JSON.parse(msg.list);
                pageVal(list);
            }else if(data.code =='-1'){
                console.log(data);
            }
        });
    }
    function pageVal(list){
        var tempHTML = '<div class="box"> <div class="left"><img src="${img}" alt=""/></div> <div class="right"> <div class="right_name">${shop}<img src="image/store_00.png" alt="" id="${store_location}"/><span>${num}&nbsp;&nbsp;|&nbsp;&nbsp;</span></div> <div class="right_add">地址：${add}</div> </div> </div>';
        var html = '';
        for(i=0;i<list.length;i++){
            var img = '';//暂无
            var shop =list[i].store_name;
            var num = list[i].is_this_area;
            var add =  list[i].province +''+ list[i].city + ''+list[i].area +''+ list[i].street; //地址是province,city,area,street这几个字段拼起来的
            var store_location = list[i].store_location;
            if(img ==''){
                img = 'image/goods_default_image.png';
            }
            var nowHTML = tempHTML;
            nowHTML = nowHTML.replace('${img}',img);
            nowHTML = nowHTML.replace('${shop}',shop);
            nowHTML = nowHTML.replace('${num}',num);
            nowHTML = nowHTML.replace('${add}',add);
            nowHTML = nowHTML.replace('${store_location}',store_location);
            html+=nowHTML;
            $('.main').html(html);
        }
        toNext();
    }
    //跳转
    function toNext(){
        $('.more_store').click(function () {
            window.location.href = 'storeList-all.html';
        });
        $('.box').click(function () {
            window.location.href = 'store_shoppers.html';
        });
        $('.right_name img').click(function(){
            event.stopPropagation(); //阻止冒泡
            alert('暂无功能');
        })
    }
   window.onload= function () {
       getPage();
   }
</script>
</body>
</html>