<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>新增</title>
    <meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport">
    <link rel="stylesheet" href="css/add_nwe.css">
    <script src="js/flexible.js"></script>
</head>
<body>
  <div class="header_bg"></div>
  <div class="header_title">
      <span class="header_title_l">秀搭标题</span>
      <span class="header_title_r">秋季活力搭配</span>
  </div>
  <div class="action">
      <span class="action_l">添加搭配</span>
      <div class="action_product">
          <div>
              <img src="image/icon_xiuda_add_product@2x.png" width="100%"height="100%" alt="照片">
          </div>
          商品
      </div>
      <div class="action_picture">
          <div>
              <img src="image/icon_xiuda_add_img@2x.png" width="100%"height="100%" alt="照片">
          </div>
          照片
          <input class="file" type="file">
      </div>
  </div>
  <ul class="container_picture">
      <!--商品模板-->
      <!--<li class="picture">-->
          <!--<div class="picture_btn"><img src="image/btn_img_del@2x_67.png"width="100%"height="100%" alt="delete"></div>-->
      <!--</li>-->
      <li class="picture_add">
          <div class="picture_add_new"><img src="image/icon_add_14x14px@3x.png" width="100%"height="100%"alt="add"></div>
      </li>
  </ul>
  <div class="line"></div>
  <div class="introduction">
      <span>搭配简介</span>
  </div>
  <div class="describe_box">
      <textarea name="" id="describe" placeholder="请填写搭配简介"></textarea>
  </div>
<script src="js/jquery-1.11.1.js"></script>
<script src="http://gosspublic.alicdn.com/aliyun-oss-sdk-4.3.0.min.js"></script>
<script>
    //照片按钮
    function addImg(){
        var self=this;
        self.client=self.client || new OSS.Wrapper({
                    region: 'oss-cn-hangzhou',
                    accessKeyId: 'O2zXL39br8rSn1zC',
                    accessKeySecret: 'XvHmCScXX9CiuMBRJ743yJdPoEiKTe',
                    bucket: 'products-image'
                });
        $(".file").on('change','',function(e){
            var file = e.target.files[0];
            var pos=file.name.lastIndexOf(".");
            var imgclass=file.name.substring(pos+1,file.name.length);
            if(imgclass =="jpg" ||imgclass =="jpeg" || imgclass =="png" || imgclass=="gif" || imgclass=="JPG"||imgclass=='PNG'||imgclass=='png' ||imgclass=='bmp' ||imgclass=='JPEG' ||imgclass=='GIF' ||imgclass=='BMP'){
                var storeAs='/MessageImage/'+pos;
                self.client.multipartUpload(storeAs, file).then(function (result) {
                    console.log(result);
                    var storeAs='http://products-image.oss-cn-hangzhou.aliyuncs.com/'+result.name;
                    showImg(storeAs);
                    //var h = date.getHours();
                    //var m = date.getMinutes();
                    //var sendTime=h+":"+m;
                    //self.sendMsgChange(sendTime,storeAs,"image");
                    console.log('发送图片的地址是：'+storeAs);
//                    sendImg(storeAs);
                    $("#upFile").val("");
                }).catch(function (err) {
                    console.log(err);
                });
            }else
            {
                alert("请确保文件为图像类型");
                return false;
            }
        })
    }
    function showImg(storeAs){
        var tempHTML = '<li class="picture"> <div class="picture_btn"><img src="${storeAs}"width="100%"height="100%" alt="delete"></div> </li>';
        var html='';
        var nowHTML = tempHTML;
        nowHTML = nowHTML.replace('${storeAs}',storeAs);
        html+=nowHTML;
        $('.picture_add').before(html);
        deleteIt();
    }
    //商品按钮
    $('.action_product').click(function () {
        window.location='add_newProduct.html';
    });
    //添加功能
    $('.picture_add img').click(function () {
        var tempHTML = '<li class="picture"> <div class="picture_btn"><img src="image/btn_img_del@2x_67.png"width="100%"height="100%" alt="delete"></div> </li>';
        var html='';
        var nowHTML = tempHTML;
        html+=nowHTML;
        $('.picture_add').before(html)
        deleteIt();
    });
    //删除功能
    function deleteIt(){
        $('.picture img').click(function () {
           $(this).parents('.picture').remove();
        });
    }

    $(document).ready(function () {
        addImg();
    });

</script>
</body>
</html>