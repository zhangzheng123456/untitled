<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <title>商品管理</title>
    <link rel="stylesheet" href="../table/css/inner.css?20161116">
    <link rel="stylesheet" href="../css/font_style.css?20161116">
    <script src="../table/js/jquery.min.js"></script>
    <!--<link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.3.0/css/bootstrap.min.css">-->
    <!--<script src="/js/loading.js?20161116"></script>-->
    <!--瀑布流-->
    <link rel="stylesheet" type="text/css" href="/js/goods/fab_match/base.css">
    <link rel="stylesheet" type="text/css" href="/js/goods/fab_match/index.css">
    <!--[if lt IE 9]>
    <script src="/js/goods/fab_match/css3-mediaqueries.js"></script>
    <![endif]-->
    <script type="text/javascript" src="/js/goods/fab_match/jquery-1.8.3.min.js"></script>
    <script type="text/javascript" src="/js/goods/fab_match/jQueryColor.js"></script>
    <!--这个插件是瀑布流主插件函数必须-->
    <script type="text/javascript" src="/js/goods/fab_match/jquery.masonry.min.js"></script>
    <!--这个插件只是为了扩展jquery的animate函数动态效果可有可无-->
    <script type="text/javascript" src="/js/goods/fab_match/jQeasing.js"></script>
    <style>
        /*主要区域*/
        #main{

        }
        /*盒子区域*/
        .boxArea{
            width: 320px;
            height: auto;
            padding-top: 40px;
            padding-left: 10px;
            background-color: #ffffff;
            position: relative;
            float: left;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        .boxArea input{
            position: absolute;
            width: 20px;
            height: 20px;
            top: 10px;
            left: 10px;
        }
        /*独立图片+文字区域*/
        .oneArea{
            /*background-color: #00625A;*/
            position: relative;
            width: 150px;
            height: 190px;
            float: left;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        .oneArea img{
            width: 150px;
            height: 150px;
            border-radius: 5px;
        }
        .oneArea div{
            width: 150px;
            height: 30px;
            line-height: 30px;
            font-size: 14px;
            color: #888888;
            text-align: center;
        }
    </style>
</head>

<body>
<div class="content">
    <div class="con_table" id="con_table">
        <div class="title">
            <span>商品管理</span>
            <span class="icon-ishop_8-03"></span>
            <span>搭配管理</span>
        </div>
        <div class="action">
            <div class="action_l">
                <ul id="jurisdiction">
                </ul>
                <ul>
                    <li class="li">
                        <input type="text" class="input" id="search" placeholder="输入搜索的内容">
                        <i class="icon-ishop_3-05" id="d_search"></i>
                    </li>
                </ul>
            </div>
            <div class="action_r">
                <ul>
                    <li id="filtrate">
                        <span class="icon-ishop_6-05"></span>
                        筛选
                    </li>
                    <li class="bg">
                    <span class="icon-ishop_6-06"></span>
                    配置
                    </li>
                    <li>
                        <span class="icon-ishop_6-07"></span>
                        刷新
                    </li>
                    <li id="more" class="bg">
                        <span class="icon-ishop_6-08"></span>
                        更多
                        <div class="more_down">
                            <div id="leading_out">导出</div>
                            <div id="guide_into">导入</div>
                        </div>
                    </li>

                </ul>
            </div>
        </div>
        <!--瀑布流布局-->
        <div class="waterfull clearfloat" id="waterfull">
            <ul>

            </ul>
        </div>
        <div id="imloading" style="width:150px;height:30px;line-height:30px;font-size:16px;text-align:center;border-radius:3px;opacity:0.7;background:#000;margin:10px auto 30px;color:#fff;display:none">
            <!--站长素材加载中.....-->
            <!--</div>-->
        </div>
        </div>
</div>
<div class="p" id="p"></div>
<div class="tk" id="tk">
    <span class="icon-ishop_6-12" id="X"></span>
    <p><i class="icon-ishop_6-14"></i>是否确认删除数据?</p>
    <div class="btn">
        <em class="cancel" id="cancel">取消</em>
        <em class="delete" id="delete">删除</em>
    </div>
</div>
<script src="http://cdn.bootcss.com/jquery/1.11.1/jquery.min.js"></script>
<script src="http://cdn.bootcss.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
<script type="text/javascript">
    /*
     抛开瀑布流布局各种乱七八糟的算法，基于masonry的瀑布流，很是简单的，而且通过扩展animate,能实现瀑布流布局的晃动、弹球等效果。
     masonry还有很多参数我这里注解了常用的参数
     */
    $(function(){
        /*瀑布流开始*/
        var container = $('.waterfull ul');
        var loading=$('#imloading');
        // 初始化loading状态
        loading.data("on",true);
        /*判断瀑布流最大布局宽度，最大为1280*/
        function tores(){
            var tmpWid=$(window).width();
            if(tmpWid>1280){
                tmpWid=1280;
            }else{
                var column=Math.floor(tmpWid/320);
                tmpWid=column*320;
            }
            $('.waterfull').width(tmpWid);
        }
        tores();
        $(window).resize(function(){
            tores();
        });
        container.imagesLoaded(function(){
            container.masonry({
                columnWidth: 320,
                itemSelector : '.item',
                isFitWidth: true,//是否根据浏览器窗口大小自动适应默认false
                isAnimated: true,//是否采用jquery动画进行重拍版
                isRTL:false,//设置布局的排列方式，即：定位砖块时，是从左向右排列还是从右向左排列。默认值为false，即从左向右
                isResizable: true,//是否自动布局默认true
                animationOptions: {
                    duration: 800,
                    easing: 'easeInOutBack',//如果你引用了jQeasing这里就可以添加对应的动态动画效果，如果没引用删除这行，默认是匀速变化
                    queue: false//是否队列，从一点填充瀑布流
                }
            });
        });
        /*模拟从后台获取到的数据*/
        var sqlJson=[{'title':'瀑布流其实就是几个函数的事！','intro':'爆料，苏亚雷斯又咬人啦，C罗哪有内马尔帅，梅西今年要不夺冠，你就去泰国吧，老子买了阿根廷赢得彩票，输了就去不成了。','src':'images/one.jpeg','writer':'站长素材','date':'2小时前','looked':321},{'title':'瀑布流其实就是几个函数的事！','intro':'爆料了，苏亚雷斯又咬人啦，C罗哪有内马尔帅，梅西今年要不夺冠，你就去泰国吧，老子买了阿根廷赢得彩票，输了就去不成了。','src':'images/demo2.jpg','writer':'站长素材','date':'2小时前','looked':321},{'title':'瀑布流其实就是几个函数的事！','intro':'爆料了，苏亚雷斯又咬人啦，C罗哪有内马尔帅，梅西今年要不夺冠，你就去泰国吧，老子买了阿根廷赢得彩票，输了就去不成了。','src':'images/p1.jpg','writer':'站长素材','date':'2小时前','looked':321},{'title':'瀑布流其实就是几个函数的事！','intro':'爆料了，苏亚雷斯又咬人啦，C罗哪有内马尔帅，梅西今年要不夺冠，你就去泰国吧，老子买了阿根廷赢得彩票，输了就去不成了。','src':'images/p1.jpg','writer':'站长素材','date':'2小时前','looked':321}];
        /*本应该通过ajax从后台请求过来类似sqljson的数据然后，便利，进行填充，这里我们用sqlJson来模拟一下数据*/
        $(window).scroll(function(){
            if(!loading.data("on")) return;
            // 计算所有瀑布流块中距离顶部最大，进而在滚动条滚动时，来进行ajax请求，方法很多这里只列举最简单一种，最易理解一种
            var itemNum=$('#waterfull').find('.item').length;
            var itemArr=[];
            itemArr[0]=$('#waterfull').find('.item').eq(itemNum-1).offset().top+$('#waterfull').find('.item').eq(itemNum-1)[0].offsetHeight;
            itemArr[1]=$('#waterfull').find('.item').eq(itemNum-2).offset().top+$('#waterfull').find('.item').eq(itemNum-1)[0].offsetHeight;
            itemArr[2]=$('#waterfull').find('.item').eq(itemNum-3).offset().top+$('#waterfull').find('.item').eq(itemNum-1)[0].offsetHeight;
            var maxTop=Math.max.apply(null,itemArr);
            if(maxTop<$(window).height()+$(document).scrollTop()){
                //加载更多数据
                loading.data("on",false).fadeIn(800);
                (function(sqlJson){
                    /*这里会根据后台返回的数据来判断是否你进行分页或者数据加载完毕这里假设大于30就不在加载数据*/
                    if(itemNum>30){
                        loading.text('就有这么多了！');
                    }else{
                        var html="";
                        for(var i in sqlJson){
                            html+="<li class='item'><a href='http://www.datouwang.com/' class='a-img'><img src='"+sqlJson[i].src+"'></a>";
                            html+="<h2 class='li-title'>"+sqlJson[i].title+"</h2>";
                            html+="<p class='description'>"+sqlJson[i].intro+"</p><div class='qianm clearfloat'>";
                            html+="<span class='sp1'><b>"+sqlJson[i].looked+"</b>浏览</span>";
                            html+="<span class='sp2'>"+sqlJson[i].writer+"</span><span class='sp3'>"+sqlJson[i].date+"&nbsp;By</span></div></li>";
                        }
                        /*模拟ajax请求数据时延时800毫秒*/
                        var time=setTimeout(function(){
                            $(html).find('img').each(function(index){
                                loadImage($(this).attr('src'));
                            })
                            var $newElems = $(html).css({ opacity: 0}).appendTo(container);
                            $newElems.imagesLoaded(function(){
                                $newElems.animate({ opacity: 1},800);
                                container.masonry( 'appended', $newElems,true);
                                loading.data("on",true).fadeOut();
                                clearTimeout(time);
                            });
                        },800)
                    }
                })(sqlJson);
            }
        });
        function loadImage(url) {
            var img = new Image();
            //创建一个Image对象，实现图片的预下载
            img.src = url;
            if (img.complete) {
                return img.src;
            }
            img.onload = function () {
                return img.src;
            };
        };
        loadImage('images/one.jpeg');
        /*item hover效果*/
        var rbgB=['#71D3F5','#F0C179','#F28386','#8BD38B'];
        $('#waterfull').on('mouseover','.item',function(){
            var random=Math.floor(Math.random() * 4);
            $(this).stop(true).animate({'backgroundColor':rbgB[random]},1000);
        });
        $('#waterfull').on('mouseout','.item',function(){
            $(this).stop(true).animate({'backgroundColor':'#fff'},1000);
        });
    })

    function pageVal(){
        //盒子上部分+复选框
        var tempHTML1='<li class="item"><div class="boxArea"><input type="checkbox"/>';
        //内容（图片+文字）迭代生成
        var tempHTML2='<div class="oneArea"> <img src="" alt=""/> <div>AJEL059598</div> </div>';
        //盒子下部分
        var tempHTML3='</div></li>';
        var html = '';
        var html2 = '';
        for(i=0;i<12;i++) {
            var nowHTML1 = tempHTML1;
            var k = Math.floor(Math.random()*4);
            for(a=0;a<k;a++) {
                var nowHTML2 = tempHTML2;
                html2 += nowHTML2;
            }
            var nowHTML3 = tempHTML3;
            //nowHTML1 = nowHTML1.replace("${value}", value);
            html += nowHTML1;
            html += html2;
            html += nowHTML3;
            $(".waterfull ul").append(html);
        }
    }
    window.onload = function(){
        pageVal();
    }
</script>
</body>
</html>