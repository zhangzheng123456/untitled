<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.bizvane.ishop.dao.SmsTemplateMapper">

    <resultMap id="MessageTemplates" type="com.bizvane.ishop.entity.SmsTemplate">
        <id column="id" property="id"/>
        <result column="template_code" property="template_code"/>
        <result column="template_name" property="template_name"/>
        <result column="template_content" property="template_content"/>
        <result column="isactive" property="isactive"/>
        <result column="corp_code" property="corp_code"/>
        <result column="modifier" property="modifier"/>
        <result column="modified_date" property="modified_date"/>
        <result column="created_date" property="created_date"/>
        <result column="creater" property="creater"/>
        <!--<result column="template_type" property="template_type"/>-->
        <association property="corp" javaType="com.bizvane.ishop.entity.Corp">
            <result column="corp_name" property="corp_name"/>
        </association>
        <!--<association property="templateType" javaType="com.bizvane.ishop.entity.TemplateType">-->
        <!--<result column="type_name" property="type_name"/>-->
        <!--</association>-->
    </resultMap>

    <!--<resultMap id="types" type="com.bizvane.ishop.entity.TemplateType">
        <id column="id" property="id"/>
        <result column="type_name" property="type_name"/>
        <result column="type_description" property="type_description"/>
        <result column="modified_date" property="modified_date"/>
        <result column="modifier" property="modifier"/>
        <result column="creater" property="creater"/>
        <result column="created_date" property="created_date"/>
        <result column="isactive" property="isactive"/>
    </resultMap>
    -->
    <select id="selectBySearch" resultMap="MessageTemplates">
        select
        dmt.id,
        dmt.template_code,
        dmt.template_name,
        dmt.template_content,
        dmt.isactive,
        dmt.corp_code,
        dmt.modifier,
        dmt.modified_date,
        dmt.created_date,
        dmt.creater,
        dc.corp_name
        from def_sms_template dmt,DEF_CORP dc
        WHERE dmt.corp_code=dc.corp_code
        <if test="corp_code!=null and corp_code!=''">
            and dmt.corp_code=#{corp_code}
        </if>
        <if test="search_value!=null and search_value!=''">
            AND
            (
            dmt.template_code like concat('%',#{search_value},'%')
            or dmt.template_name like concat('%',#{search_value},'%')
            or dmt.template_content like concat('%',#{search_value},'%')
            or dc.corp_name like concat('%',#{search_value},'%')
            or dmt.modifier like concat('%',#{search_value},'%')
            or dmt.modified_date like concat('%',#{search_value},'%')
            or dmt.isactive like concat('%',#{search_value},'%')
            )
        </if>
        ORDER by dmt.id DESC

    </select>

    <select id="selectByPrimaryKey" resultMap="MessageTemplates">
        select
        dmt.id,
        dmt.template_code,
        dmt.template_name,
        dmt.template_content,
        dmt.template_type,
        dmt.isactive,
        dmt.corp_code,
        dmt.modifier,
        dmt.modified_date,
        dmt.created_date,
        dmt.creater,
        dc.corp_name
        from def_sms_template dmt,DEF_CORP dc
        WHERE dmt.corp_code=dc.corp_code  and dmt.id=#{id}
           </select>

    <insert id="insert" parameterType="com.bizvane.ishop.entity.SmsTemplate">
        insert into def_sms_template
        <trim prefix="(" suffixOverrides="," suffix=")">
            <if test="template_code!=null and template_code!=''">
                template_code,
            </if>
            <if test="template_name!=null  and template_name!=''">
                template_name ,
            </if>
            <if test="template_content!=null and template_content!=''">
                template_content ,
            </if>
            <if test="isactive!=null and isactive!=''">
                isactive ,
            </if>
            <if test="corp_code!=null and corp_code!=''">
                corp_code ,
            </if>
            <if test="modified_date!=null and modified_date!=''">
                modified_date,
            </if>
            <if test="modifier!=null and modifier!=''">
                modifier ,
            </if>
            <if test="created_date!=null and  created_date!=''">
                created_date ,
            </if>
            <if test="creater!=null and  creater!=''">
                creater ,
            </if>
        </trim>
        <trim prefix="values(" suffix=")" suffixOverrides=",">
            <if test="template_code!=null and template_code!=''">
                #{template_code},
            </if>
            <if test="template_name!=null  and template_name!=''">
                #{template_name },
            </if>
            <if test="template_content!=null and template_content!=''">
                #{template_content},
            </if>
            <if test="isactive!=null and isactive!=''">
                #{isactive} ,
            </if>
            <if test="corp_code!=null and corp_code!=''">
                #{corp_code} ,
            </if>
            <if test="modified_date!=null and modified_date!=''">
                #{modified_date},
            </if>
            <if test="modifier!=null and modifier!=''">
                #{modifier} ,
            </if>
            <if test="created_date!=null and  created_date!=''">
                #{created_date} ,
            </if>
            <if test="creater!=null and  creater!=''">
                #{creater} ,
            </if>
        </trim>
    </insert>

    <update id="updateByPrimaryKey" parameterType="com.bizvane.ishop.entity.SmsTemplate">
        update def_sms_template
        <trim prefix="set" suffixOverrides=",">
            <if test="template_code!=null and template_code!=''">
                template_code=#{template_code},
            </if>
            <if test="template_name!=null  and template_name!=''">
                template_name=#{template_name},
            </if>
            <if test="template_content!=null and template_content!=''">
                template_content=#{template_content},
            </if>
            <if test="isactive!=null and isactive!=''">
                isactive=#{isactive} ,
            </if>
            <if test="corp_code!=null and corp_code!=''">
                corp_code=#{corp_code} ,
            </if>
            <if test="modified_date!=null and modified_date!=''">
                modified_date=#{modified_date},
            </if>
            <if test="modifier!=null and modifier!=''">
                modifier=#{modifier} ,
            </if>
            <if test="created_date!=null and  created_date!=''">
                created_date=#{created_date} ,
            </if>
            <if test="creater!=null and  creater!=''">
                creater=#{creater} ,
            </if>
        </trim>
        WHERE id=#{id}
    </update>

    <delete id="deleteByPrimaryKey">
        delete FROM  def_sms_template WHERE id=#{id}
    </delete>

    <select id="selectByName" resultType="com.bizvane.ishop.entity.SmsTemplate">
        select * from def_sms_template WHERE template_name=#{template_name} and corp_code=#{corp_code}
    </select>

    <select id="selectByCode" resultType="com.bizvane.ishop.entity.SmsTemplate">
        select * from def_sms_template WHERE template_code=#{template_code} and corp_code=#{corp_code}
    </select>

    <!--   <select id="getTypes" resultMap="types">
           select * from def_template_type
       </select>
   -->

    <select id="selectAllSmsTemplateScreen" resultMap="MessageTemplates">
        select
        dmt.id,
        dmt.template_code,
        dmt.template_name,
        dmt.template_content,
        dmt.isactive,
        dmt.corp_code,
        dmt.modifier,
        dmt.modified_date,
        dmt.created_date,
        dmt.creater,
        dc.corp_name
        from def_sms_template dmt,DEF_CORP dc
        WHERE dmt.corp_code=dc.corp_code
        <if test="corp_code!=null and corp_code!=''">
            and dmt.corp_code=#{corp_code}
        </if>
        AND
        <foreach collection="map" index="entryKey" item="entryValue" open="(" separator="AND" close=")">
            <choose>
                <when test="entryKey=='corp_name'">
                    dc.${entryKey} like concat('%',#{entryValue},'%')
                </when>
                <otherwise>
                    dmt.${entryKey} LIKE concat('%',#{entryValue},'%')
                </otherwise>
            </choose>
        </foreach>
        ORDER by dmt.id DESC
    </select>
</mapper>
